# リリース戦略を考える

まずリリース戦略を考えます。
サーバに配置(デプロイ)したり、リリースビルドを作ったりするのがリリース作業です。
プログラミングの最終目標はリリースです。
リリース戦略から考えることで、作戦の方向性を間違えないようにします。

## もちろんGitを使う

手作業のリリース作業は絶対にしてはいけません。
gitのコードを自動でリリースする仕組みを作りましょう。
自動化することで作業の属人化を防ぎ、事故を減らすことができます。

rubyにはcapistranoというデプロイツールがあり、広く使われています。
仕組みとしては単純なので、Webアプリであればruby以外の言語でも簡単に使うことができます。
Chrome Extensionのためのcrxmakeなど、めんどくさがりが多いrubyistはいろいろビルドツールを作っていますので探してみてください。

よさげなのが見つからなくても、簡単なMakefileを書けば十分実用的なビルドツールが作れると思います。

- gitからリモートブランチを毎回チェックアウトする
- コマンド一発で全部終わる
- 誰がやっても同じ結果になる

この2点さえ満たせば十分安全だと思います。

gitでpushしたら自動で更新されるherokuのようなかっこいいプラットフォームもあります。
ごく普通のWeb開発ならherokuを使うのが一番楽なんじゃないかと思います。

## デプロイ環境

Webアプリだと少なくとも3つのデプロイ環境が必要になると思います。

### production (本番環境)

実際にユーザがアクセスする本番環境です。
gitの **masterブランチ** がデプロイされます。
データは基本的にユーザが登録していくものだけです。
「本番でテストデータ500件登録させてくださいー」とか言ってくるバカ(実在)は全員ぶっ殺しましょう。

### staging (本番と同じ状態の開発検証環境)

本番環境と同じコードが動いている開発検証環境です。
gitの **masterブランチ** がデプロイされます。
本番環境で出たバグを再現させて検証/修正したり、
APIを提供している場合は他チームの開発環境から繋いだり、
「本番でテストデータ500件登録させてくださいー」とか言ってくるバカ(実在)に「stagingでやれ」って言ったりします。

### development (開発用環境)

開発者が開発用に自由にいじる環境です。
gitの **developmentブランチ** がデプロイされます。
開発中の機能を確認したり、仕様バグを洗い出したりします。
常に新しいコードがデプロイされるので不安定になったりもするので、
他チームからはあまり繋がせるべきではないと思います。
「dev動かなくなってるんですけどー 困るんですよねーこっちも開発止まっちゃうんでー」とか言ってくるバカ(実在)には「stagingでやれって行ってんだろクズ!」って言っておきましょう。

## デプロイを踏まえたリモートブランチ運用

以上のように、リモートブランチとして最低でも、

- 常に最新の安定したコードが入っているmasterブランチ
- 開発中のコードが入っていていつでもぶっ壊しても問題ないdevelopmentブランチ

が必要です。

他に、大規模な変更がある場合、development環境と同等の扱いの、
専用の開発環境とそれに対応するリモートブランチを作るべきです。
大規模な変更とは、ミドルウェアのバージョンアップや、サイトのリニューアル(なぜか頻繁にある)などがあります。
